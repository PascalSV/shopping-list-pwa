<!doctype html>
<html lang="de">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no" />
    <meta name="theme-color" content="#6366f1" />
    <link rel="stylesheet" href="/styles.css" />
    <title>Einkaufsliste – Login</title>
</head>

<body>
    <main class="app login-app">
        <header>
            <div class="header-content">
                <h1>Einkaufsliste</h1>
                <p class="login-subtitle">Bitte anmelden</p>
            </div>
        </header>

        <section class="content login-content">
            <div class="login-card">
                <h2>Anmeldung</h2>
                <p class="login-hint">Wähle einen Benutzer und gib das Passwort ein.</p>

                <div class="login-users">
                    <button class="user-btn" data-user="Pascal">Pascal</button>
                    <button class="user-btn" data-user="Claudia">Claudia</button>
                </div>

                <label class="login-label" for="login-password">Passwort</label>
                <input id="login-password" type="password" class="login-input" placeholder="Passwort"
                    autocomplete="current-password" />

                <button id="login-submit" class="modal-btn primary login-submit">Anmelden</button>
                <div id="login-error" class="login-error" aria-live="polite"></div>
            </div>
        </section>
    </main>

    <script>
        (function () {
            const userButtons = Array.from(document.querySelectorAll('.user-btn'));
            const passwordInput = document.getElementById('login-password');
            const submitBtn = document.getElementById('login-submit');
            const errorEl = document.getElementById('login-error');
            let selectedUser = null;

            function setSelected(user) {
                selectedUser = user;
                userButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.user === user);
                });
            }

            userButtons.forEach(btn => {
                btn.addEventListener('click', () => setSelected(btn.dataset.user));
            });

            async function login() {
                errorEl.textContent = '';
                const password = passwordInput.value.trim();
                if (!selectedUser) {
                    errorEl.textContent = 'Bitte Benutzer auswählen.';
                    return;
                }
                if (!password) {
                    errorEl.textContent = 'Bitte Passwort eingeben.';
                    return;
                }
                try {
                    const res = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user: selectedUser, password })
                    });
                    if (!res.ok) {
                        errorEl.textContent = 'Anmeldung fehlgeschlagen.';
                        return;
                    }
                    window.location.href = '/';
                } catch (err) {
                    errorEl.textContent = 'Netzwerkfehler. Bitte erneut versuchen.';
                }
            }

            submitBtn.addEventListener('click', login);
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    login();
                }
            });
        })();
    </script>
</body>

</html>